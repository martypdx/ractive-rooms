{"version":3,"sources":["/Users/marty/dev/ractive-rooms/assets/js/new-stroll.js"],"names":[],"mappings":"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","file":"/Users/marty/dev/ractive-rooms/.gobble-build/08-babel/1/new-stroll.js","sourcesContent":["export default function stroll(node, position, max, min){\n\n    var ractive = this,\n        pointer = false,\n        handler;\n\n\n    handler = {\n        start: function(){\n            // pointer = true\n        },\n        move: function(values){\n            var setter = {};\n            setter[position.x] = values.offset.x;\n            setter[position.y] = values.offset.y;\n            ractive.set(setter)\n\n            // console.log(values.offset, values.delta)\n\n            // if(pointer) { return }\n\n            // if(Math.abs(values.delta) < 2) {\n            //     ractive.fire('stop')\n            // }\n        },\n        release: function(){\n            // pointer = false\n            // ractive.fire('start')\n        },\n        end: function(){\n            // ractive.fire('stop')\n        }\n    }\n\n    var scroll = scroller(\n        document,\n        node,\n        max,\n        min || { x: 0, y: 0 },\n        handler\n    );\n    console.log( 'start' );\n    scroll.start();\n\n    return {\n        teardown: function(){\n            if(scroll){\n                scroll.stop()\n            }\n        }\n    }\n}\n\n\n\nfunction scroller(listenOn, toScroll, max, min, handler){\n\n    var offset, reference, pressed,\n        velocity, frame, timestamp, ticker,\n        amplitude, target, timeConstant;\n\n    return {\n        start: start,\n        stop: stop\n    }\n\n    function start() {\n        if (typeof window.ontouchstart !== 'undefined') {\n            listenOn.addEventListener('touchstart', tap);\n            listenOn.addEventListener('touchmove', drag);\n            listenOn.addEventListener('touchend', release);\n        }\n        listenOn.addEventListener('mousedown', tap);\n        listenOn.addEventListener('mousemove', drag);\n        listenOn.addEventListener('mouseup', release);\n\n        offset = {\n            x: min.x,\n            y: min.y\n        };\n        velocity = {\n            x: 0,\n            y: 0\n        };\n        pressed = false;\n        timeConstant = 325; // ms\n\n    };\n\n    function stop() {\n\n        if (typeof window.ontouchstart !== 'undefined') {\n            listenOn.removeEventListener('touchstart', tap);\n            listenOn.removeEventListener('touchmove', drag);\n            listenOn.removeEventListener('touchend', release);\n        }\n        listenOn.removeEventListener('mousedown', tap);\n        listenOn.removeEventListener('mousemove', drag);\n        listenOn.removeEventListener('mouseup', release);\n    }\n\n    function pos(e) {\n        // touch event\n        if (e.targetTouches && (e.targetTouches.length >= 1)) {\n            var e = e.targetTouches[0];\n        }\n\n        return {\n            x: e.clientX,\n            y: e.clientY\n        };\n    }\n\n    function scroll(pos) {\n\n        offset = {\n            x: (pos.x > min.x) ? min.x : (pos.x < -max.x) ? -max.x : pos.x,\n            y: (pos.y > min.y) ? min.y : (pos.y < -max.y) ? -max.y : pos.y\n        };\n\n        handler.move({\n            offset: offset\n        })\n    }\n\n    function track() {\n        var now, elapsed, dx, dy, delta, vx, vy;\n\n        now = Date.now();\n        elapsed = now - timestamp;\n        timestamp = now;\n\n        delta = {\n            x: offset.x - frame.x,\n            y: offset.y - frame.y\n        };\n\n        frame = {\n            x: offset.x,\n            y: offset.y\n        };\n\n        vx = 1000 * delta.x / (1 + elapsed);\n        vy = 1000 * delta.y / (1 + elapsed);\n\n        velocity = {\n            x: 0.8 * vx + 0.2 * velocity.x,\n            y: 0.8 * vy + 0.2 * velocity.y\n        };\n    }\n\n    function autoScroll() {\n        var elapsed, delta, amp, xlimit, ylimit;\n\n        if (amplitude) {\n            elapsed = Date.now() - timestamp;\n            amp = Math.exp(-elapsed / timeConstant);\n            delta = {\n                x: -amplitude.x * amp,\n                y: -amplitude.y * amp\n            };\n\n            if (delta.x > 0.5 || delta.x < -0.5 || delta.y > 0.5 || delta.y < -0.5) {\n                xlimit = offset.x === min.x || offset.x === -max.x;\n                ylimit = offset.y === min.y || offset.y === -max.y;\n\n                scroll({\n                    x: xlimit ? target.x : target.x + delta.x,\n                    y: ylimit ? target.y : target.y + delta.y\n                });\n\n                if (xlimit && ylimit){\n                    handler.end(target);\n                    return\n                }\n                requestAnimationFrame(autoScroll);\n            } else {\n                scroll(target);\n                handler.end(target)\n            }\n        }\n    }\n\n    function tap(e) {\n        pressed = true;\n        reference = pos(e);\n        console.log( reference );\n\n        velocity = { x: 0, y: 0 };\n        amplitude = { x: 0, y: 0 };\n        frame = { x: offset.x, y: offset.y };\n\n        timestamp = Date.now();\n        clearInterval(ticker);\n        ticker = setInterval(track, 30);\n\n        handler.start()\n\n        e.preventDefault();\n        e.stopPropagation();\n        return false;\n    }\n\n    function drag(e) {\n        var point, delta;\n        if (pressed) {\n            point = pos(e);\n            delta = {\n                x: reference.x - point.x,\n                y: reference.y - point.y\n            };\n            if (delta.x > 2 || delta.x < -2 || delta.y > 2 || delta.y < -2) {\n                reference = point;\n                var mark = {\n                    x: offset.x + delta.x,\n                    y: offset.y + delta.y\n                };\n                scroll(mark);\n            }\n        }\n        e.preventDefault();\n        e.stopPropagation();\n        return false;\n    }\n\n    function release(e) {\n        pressed = false;\n\n        handler.release()\n\n        clearInterval(ticker);\n        if (velocity.x > 10 || velocity.x < -10  || velocity.y > 10 || velocity.y < -10) {\n\n            amplitude = {\n                x: 0.8 * velocity.x,\n                y: 0.8 * velocity.y\n            };\n\n            target = {\n                x: Math.round(offset.x + amplitude.x),\n                y: Math.round(offset.y + amplitude.y)\n            };\n\n            timestamp = Date.now();\n            requestAnimationFrame(autoScroll);\n        } else {\n            handler.end(offset)\n        }\n        e.preventDefault();\n        e.stopPropagation();\n        return false;\n    }\n\n}\n"]}